# iSCSI block storage server

iSCSI targets are servers that share out block devices

iSCSI initiators are clients

## Install

    yum install targetd targetcli

    systemctl enable targetd # don’t need to start service - the kernel does it automatically

    firewall-cmd —add-service=iscsi-target —permanent

    firewall-cmd —reload

    firewall-cmd —list-services

## Share out LVMs

Prepare a logical volume without a filesystem

    vgs

    lvcreate -L 100m -n web_lv vg1

Configure target (server):

    targetcli

In the CLI

    backstore/block create web_store /dev/vg1/web_lv

    iscsi/ create iqn.2016-02.com.example.server1:web

    ls

    cd iscsi/ iqn.2016-02.com.example.server1:web:/tpg1

    luns/ create /backstores/block/web_store

    acls/ create iqn.2016-02.com.example.server2:web

    exit

This writes the config.

    netstat -ltn

Look for port 3260

## Configure iSCSI initiator

On the client

    yum install iscsi-initiator-utils

Edit the client name

    vi /etc/iscsi/initiatorname.iscsi

Set the name as per the ACL in the server.

    InitiatorName=iqn.2016-02.com.example.server2:web

Connect:

    iscsiadm —mode discovery —type sendtargets —portal server1.example.com —discover

    lsblk # target not listed yet

    iscsiadm —mode node —targetname iqn.2016-02.com.example.server1:web —portal server1.example.com —login

    lsblk # can see it now









